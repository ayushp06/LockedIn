if("undefined"!=typeof window){const t=document.createElement;document.createElement=function(e){const s=t.call(this,e);if("script"===e.toLowerCase()){const t=s.setAttribute;s.setAttribute=function(e,s){if("src"!==e||!s.includes("apis.google.com")&&!s.includes("recaptcha"))return t.call(this,e,s);console.warn("External script loading blocked:",s)}}return s}}(globalThis.webpackChunklockedin_extension=globalThis.webpackChunklockedin_extension||[]).push([[76],{51:(t,e,s)=>{s.d(e,{HF:()=>i.HF,db:()=>o,j2:()=>n});var a=s(223),i=s(9511),r=s(2405);const d=(0,a.Wp)({apiKey:"AIzaSyC-0hXTfU-L9b87YWcx2gTRT_G5IHKaL8w",authDomain:"lockedin-544ce.firebaseapp.com",projectId:"lockedin-544ce",storageBucket:"lockedin-544ce.firebasestorage.app",messagingSenderId:"880132322779",appId:"1:880132322779:web:bde3d03103c5ac0f08a3fe",measurementId:"G-PMML07PNJ2"}),n=(0,i.xI)(d),o=(0,r.aU)(d)},6164:(t,e,s)=>{s.d(e,{DL:()=>r,DailyStatsService:()=>n,Ky:()=>c,WorkSessionService:()=>d,x5:()=>o});var a=s(2405),i=s(51);class r{static async createUser(t){const e=(0,a.H9)(i.db,"users",t.uid);await(0,a.BN)(e,{...t,createdAt:(0,a.O5)(),lastActiveAt:(0,a.O5)(),totalWorkTime:0,dailyGoal:3,streak:0,achievements:[]})}static async getUser(t){const e=(0,a.H9)(i.db,"users",t),s=await(0,a.x7)(e);if(s.exists()){const t=s.data();return{...t,createdAt:t.createdAt?.toDate()||new Date,lastActiveAt:t.lastActiveAt?.toDate()||new Date}}return null}static async updateUser(t,e){const s=(0,a.H9)(i.db,"users",t);await(0,a.mZ)(s,{...e,lastActiveAt:(0,a.O5)()}),void 0!==e.dailyGoal&&await n.updateStreak(t)}static async updateUserActivity(t){const e=(0,a.H9)(i.db,"users",t);await(0,a.mZ)(e,{lastActiveAt:(0,a.O5)()})}static async getUserWithStreak(t){const e=(0,a.H9)(i.db,"users",t),s=await(0,a.x7)(e);if(s.exists()){const t=s.data();return{streak:t.streak||0,dailyGoal:t.dailyGoal||3}}return null}}class d{static async startSession(t,e){return(await(0,a.gS)((0,a.rJ)(i.db,"workSessions"),{userId:t,startTime:(0,a.O5)(),duration:0,website:e,isActive:!0})).id}static async endSession(t){const e=(0,a.H9)(i.db,"workSessions",t),s=await(0,a.x7)(e);if(s.exists()){const t=s.data(),i=t.startTime.toDate(),r=(new Date).getTime()-i.getTime();await(0,a.mZ)(e,{endTime:(0,a.O5)(),duration:r,isActive:!1}),await this.updateUserWorkTime(t.userId,r),await this.incrementSessionCounter(t.userId)}}static async incrementSessionCounter(t){const e=(new Date).toISOString().split("T")[0],s=`${t}_${e}`,r=(0,a.H9)(i.db,"dailyStats",s),d=await(0,a.x7)(r);if(d.exists()){const t=d.data();await(0,a.mZ)(r,{sessions:t.sessions+1})}else await(0,a.BN)(r,{userId:t,date:e,totalWorkTime:0,sessions:1,websites:[],goalAchieved:!1})}static async getActiveSession(t){const e=(0,a.P)((0,a.rJ)(i.db,"workSessions"),(0,a._M)("userId","==",t),(0,a._M)("isActive","==",!0),(0,a.AB)(1)),s=await(0,a.GG)(e);if(!s.empty){const t=s.docs[0],e=t.data();return{id:t.id,...e,startTime:e.startTime.toDate(),endTime:e.endTime?.toDate()}}return null}static async getUserSessions(t,e=50){const s=(0,a.P)((0,a.rJ)(i.db,"workSessions"),(0,a._M)("userId","==",t),(0,a.My)("startTime","desc"),(0,a.AB)(e));return(await(0,a.GG)(s)).docs.map(t=>({id:t.id,...t.data(),startTime:t.data().startTime.toDate(),endTime:t.data().endTime?.toDate()}))}static async updateUserWorkTime(t,e){const s=(0,a.H9)(i.db,"users",t),r=await(0,a.x7)(s);if(r.exists()){const t=r.data().totalWorkTime||0;await(0,a.mZ)(s,{totalWorkTime:t+e})}}}class n{static async updateDailyStats(t,e,s){const r=(new Date).toISOString().split("T")[0],d=`${t}_${r}`,n=(0,a.H9)(i.db,"dailyStats",d),o=await(0,a.x7)(n),c=await(0,a.x7)((0,a.H9)(i.db,"users",t)),u=e>=60*(c.data()?.dailyGoal||3)*60*1e3;if(o.exists()){const t=o.data(),i=[...new Set([...t.websites,s])];await(0,a.mZ)(n,{totalWorkTime:e,sessions:t.sessions,websites:i,goalAchieved:u})}else await(0,a.BN)(n,{userId:t,date:r,totalWorkTime:e,sessions:0,websites:[s],goalAchieved:u});await this.updateStreak(t)}static async updateStreak(t){const e=new Date,s=`${t}_${e.toISOString().split("T")[0]}`,r=(0,a.H9)(i.db,"dailyStats",s),d=await(0,a.x7)(r);let n=0;if(d.exists())if(d.data().goalAchieved){let s=new Date(e),r=0;for(;;){const e=`${t}_${s.toISOString().split("T")[0]}`,d=(0,a.H9)(i.db,"dailyStats",e),n=await(0,a.x7)(d);if(!n.exists())break;if(!n.data().goalAchieved)break;r++,s.setDate(s.getDate()-1)}n=r}else n=0;else n=0;const o=(0,a.H9)(i.db,"users",t);await(0,a.mZ)(o,{streak:n,lastActiveAt:(0,a.O5)()})}static async getTodayStats(t){const e=`${t}_${(new Date).toISOString().split("T")[0]}`,s=(0,a.H9)(i.db,"dailyStats",e),r=await(0,a.x7)(s);return r.exists()?{id:r.id,...r.data()}:null}static async resetStreakForInactiveUsers(){const t=(new Date).toISOString().split("T")[0],e=(0,a.P)((0,a.rJ)(i.db,"users")),s=await(0,a.GG)(e);for(const e of s.docs){const s=e.id,r=`${s}_${t}`,d=(0,a.H9)(i.db,"dailyStats",r),n=await(0,a.x7)(d);if(n.exists()){if(!n.data().goalAchieved){const t=(0,a.H9)(i.db,"users",s);await(0,a.mZ)(t,{streak:0,lastActiveAt:(0,a.O5)()})}}else{const t=(0,a.H9)(i.db,"users",s);await(0,a.mZ)(t,{streak:0,lastActiveAt:(0,a.O5)()})}}}static async getUserWeeklyStats(t){const e=new Date;e.setDate(e.getDate()-7);const s=e.toISOString().split("T")[0],r=(0,a.P)((0,a.rJ)(i.db,"dailyStats"),(0,a._M)("userId","==",t),(0,a._M)("date",">=",s),(0,a.My)("date","desc"));return(await(0,a.GG)(r)).docs.map(t=>({id:t.id,...t.data()}))}}class o{static async getLeaderboard(t="daily"){const e=(new Date).toISOString().split("T")[0];if("daily"===t){const t=(0,a.P)((0,a.rJ)(i.db,"dailyStats"),(0,a._M)("date","==",e),(0,a.My)("totalWorkTime","desc"),(0,a.AB)(10)),s=await(0,a.GG)(t),r=[];for(const t of s.docs){const e=t.data(),s=await(0,a.x7)((0,a.H9)(i.db,"users",e.userId));if(s.exists()){const t=s.data();e.userId.startsWith("test-user-")||r.push({userId:e.userId,userName:t.displayName,userEmail:t.email,totalWorkTime:e.totalWorkTime,rank:r.length+1,streak:t.streak||0})}}return r}{const t=new Date;t.setDate(t.getDate()-7);const e=t.toISOString().split("T")[0],s=(0,a.P)((0,a.rJ)(i.db,"dailyStats"),(0,a._M)("date",">=",e),(0,a.My)("date","desc")),r=await(0,a.GG)(s),d={};for(const t of r.docs){const e=t.data();if(!e.userId.startsWith("test-user-")){if(!d[e.userId]){const t=await(0,a.x7)((0,a.H9)(i.db,"users",e.userId));if(t.exists()){const s=t.data();d[e.userId]={totalTime:0,userName:s.displayName,userEmail:s.email,streak:s.streak||0}}}d[e.userId]&&(d[e.userId].totalTime+=e.totalWorkTime)}}const n=Object.entries(d).map(([t,e])=>({userId:t,userName:e.userName,userEmail:e.userEmail,totalWorkTime:e.totalTime,rank:0,streak:e.streak})).sort((t,e)=>e.totalWorkTime-t.totalWorkTime).slice(0,10);return n.forEach((t,e)=>{t.rank=e+1}),n}}static subscribeToLeaderboard(t,e,s){const r=(new Date).toISOString().split("T")[0];if("daily"===t){const t=(0,a.P)((0,a.rJ)(i.db,"dailyStats"),(0,a._M)("date","==",r),(0,a.My)("totalWorkTime","desc"),(0,a.AB)(50));return(0,a.aQ)(t,async t=>{const r=[];let d=[];if(s)try{d=(await c.getFriends(s)).map(t=>t.userId===s?t.friendId:t.userId),d.push(s)}catch(t){console.error("Error getting friends for leaderboard:",t)}for(const e of t.docs){const t=e.data(),s=await(0,a.x7)((0,a.H9)(i.db,"users",t.userId));if(s.exists()){const e=s.data();t.userId.startsWith("test-user-")||0!==d.length&&!d.includes(t.userId)||r.push({userId:t.userId,userName:e.displayName,userEmail:e.email,totalWorkTime:t.totalWorkTime,rank:r.length+1,streak:e.streak||0})}}r.sort((t,e)=>e.totalWorkTime-t.totalWorkTime),r.forEach((t,e)=>{t.rank=e+1}),e(r.slice(0,10))})}{const t=new Date;t.setDate(t.getDate()-7);const r=t.toISOString().split("T")[0],d=(0,a.P)((0,a.rJ)(i.db,"dailyStats"),(0,a._M)("date",">=",r),(0,a.My)("date","desc"));return(0,a.aQ)(d,async t=>{const r={};let d=[];if(s)try{d=(await c.getFriends(s)).map(t=>t.userId===s?t.friendId:t.userId),d.push(s)}catch(t){console.error("Error getting friends for weekly leaderboard:",t)}for(const e of t.docs){const t=e.data();if(!t.userId.startsWith("test-user-")&&(0===d.length||d.includes(t.userId))){if(!r[t.userId]){const e=await(0,a.x7)((0,a.H9)(i.db,"users",t.userId));if(e.exists()){const s=e.data();r[t.userId]={totalTime:0,userName:s.displayName,userEmail:s.email,streak:s.streak||0}}}r[t.userId]&&(r[t.userId].totalTime+=t.totalWorkTime)}}const n=Object.entries(r).map(([t,e])=>({userId:t,userName:e.userName,userEmail:e.userEmail,totalWorkTime:e.totalTime,rank:0,streak:e.streak})).sort((t,e)=>e.totalWorkTime-t.totalWorkTime).slice(0,10);n.forEach((t,e)=>{t.rank=e+1}),e(n)})}}}class c{static async sendFriendRequest(t,e){if(i.j2.currentUser?.email===e)throw new Error("You cannot add yourself as a friend");const s=(0,a.P)((0,a.rJ)(i.db,"users"),(0,a._M)("email","==",e),(0,a.AB)(1)),r=await(0,a.GG)(s);if(r.empty)throw new Error("User not found");const d=r.docs[0],n=d.id,o=(0,a.P)((0,a.rJ)(i.db,"friends"),(0,a._M)("userId","==",t),(0,a._M)("friendId","==",n)),c=await(0,a.GG)(o);if(!c.empty){const t=c.docs[0].data();if("pending"===t.status)throw new Error("Friend request already sent");if("accepted"===t.status)throw new Error("This user is already your friend")}const u=(0,a.P)((0,a.rJ)(i.db,"friends"),(0,a._M)("userId","==",n),(0,a._M)("friendId","==",t)),l=await(0,a.GG)(u);if(!l.empty){const t=l.docs[0].data();if("pending"===t.status)throw new Error("This user has already sent you a friend request");if("accepted"===t.status)throw new Error("This user is already your friend")}await(0,a.gS)((0,a.rJ)(i.db,"friends"),{userId:t,friendId:n,friendEmail:e,friendName:d.data().displayName,status:"pending",createdAt:(0,a.O5)()})}static async getFriends(t){const e=(0,a.P)((0,a.rJ)(i.db,"friends"),(0,a.or)((0,a.Uo)((0,a._M)("userId","==",t),(0,a._M)("status","==","accepted")),(0,a.Uo)((0,a._M)("friendId","==",t),(0,a._M)("status","==","accepted")))),s=await(0,a.GG)(e),r=[],d=new Set;for(const e of s.docs){const s=e.data(),n=s.userId===t?s.friendId:s.userId;if(!d.has(n)){d.add(n);const t=await(0,a.x7)((0,a.H9)(i.db,"users",n));if(t.exists()){const a=t.data();r.push({id:e.id,userId:s.userId,friendId:s.friendId,friendEmail:s.friendEmail||a.email,friendName:s.friendName||a.displayName,status:s.status,createdAt:s.createdAt?.toDate?.()??new Date})}}}return r}static async getPendingRequests(t){const e=(0,a.P)((0,a.rJ)(i.db,"friends"),(0,a._M)("friendId","==",t),(0,a._M)("status","==","pending")),s=await(0,a.GG)(e),r=[];for(const t of s.docs){const e=t.data(),s=e.userId,d=(await(0,a.x7)((0,a.H9)(i.db,"users",s))).data();r.push({id:t.id,userId:e.userId,friendId:e.friendId,friendEmail:d?.email||e.friendEmail,friendName:d?.displayName||e.friendName,status:e.status,createdAt:e.createdAt?.toDate?.()??new Date})}return r}static async acceptFriendRequest(t){const e=(0,a.H9)(i.db,"friends",t),s=await(0,a.x7)(e);if(s.exists()){const t=s.data();if(await(0,a.mZ)(e,{status:"accepted"}),(await(0,a.GG)((0,a.P)((0,a.rJ)(i.db,"friends"),(0,a._M)("userId","==",t.friendId),(0,a._M)("friendId","==",t.userId)))).empty){const e=(await(0,a.x7)((0,a.H9)(i.db,"users",t.friendId))).data();await(0,a.gS)((0,a.rJ)(i.db,"friends"),{userId:t.friendId,friendId:t.userId,friendEmail:e?.email,friendName:e?.displayName,status:"accepted",createdAt:(0,a.O5)()})}}}static async removeFriend(t){const e=(0,a.H9)(i.db,"friends",t),s=await(0,a.x7)(e);if(s.exists()){const t=s.data();await(0,a.kd)(e);const r=(0,a.P)((0,a.rJ)(i.db,"friends"),(0,a._M)("userId","==",t.friendId),(0,a._M)("friendId","==",t.userId)),d=await(0,a.GG)(r);if(!d.empty){const t=d.docs[0];await(0,a.kd)(t.ref)}}}static async cleanupDuplicateFriends(t){const e=(0,a.P)((0,a.rJ)(i.db,"friends"),(0,a.or)((0,a._M)("userId","==",t),(0,a._M)("friendId","==",t))),s=await(0,a.GG)(e),r=new Map,d=[];for(const e of s.docs){const s=e.data(),a=s.userId===t?s.friendId:s.userId,i=t<a?`${t}_${a}`:`${a}_${t}`;if(r.has(i)){const t=r.get(i);(s.createdAt?.toDate?.()||new Date(0))>(t.createdAt?.toDate?.()||new Date(0))?(d.push(t.id),r.set(i,{...s,id:e.id})):d.push(e.id)}else r.set(i,{...s,id:e.id})}for(const t of d)await(0,a.kd)((0,a.H9)(i.db,"friends",t))}}}}]);